# üî• –°–†–û–ß–ù–û: –û–±–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ Firestore –≤ Firebase Console

## ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞:** "Missing or insufficient permissions"

–ó–∞—è–≤–∫–∏ –±–∏–∑–Ω–µ—Å–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

## ‚ö° **–ù–ï–ú–ï–î–õ–ï–ù–ù–û–ï –†–ï–®–ï–ù–ò–ï:**

### **1. –û—Ç–∫—Ä–æ–π—Ç–µ Firebase Console**
- https://console.firebase.google.com
- –ü—Ä–æ–µ–∫—Ç: **nearby-74439**
- Firestore Database ‚Üí **–ü—Ä–∞–≤–∏–ª–∞** (Rules)

### **2. –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–ú–ï–ù–ò–¢–ï —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞:**

**–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≠–¢–ò –ø—Ä–∞–≤–∏–ª–∞:**

```javascript
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    match /users/{userId} {
      // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –∏ –ø–∏—Å–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ñ–∏–ª–µ–π
    match /businessProfiles/{profileId} {
      // –ß—Ç–µ–Ω–∏–µ: –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –≤—Å–µ –ø—Ä–æ—Ñ–∏–ª–∏
      allow read: if request.auth != null;
      
      // –°–æ–∑–¥–∞–Ω–∏–µ: –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É, –µ—Å–ª–∏ userId —Å–æ–≤–ø–∞–¥–∞–µ—Ç
      allow create: if request.auth != null && 
                   request.auth.uid == request.resource.data.userId;
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å, 
      // –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
      allow update: if request.auth != null && (
        // –í–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å (–ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ userId)
        (request.auth.uid == resource.data.userId) ||
        // –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
        (request.auth.token.email == 'malina@gmail.com' && 
         onlyUpdatingFields(['verificationStatus', 'isVerified', 'updatedAt']))
      );
      
      // –£–¥–∞–ª–µ–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
      allow delete: if request.auth != null && (
        request.auth.uid == resource.data.userId ||
        request.auth.token.email == 'malina@gmail.com'
      );
    }
    
    // üåç –ü–†–ê–í–ò–õ–ê –î–õ–Ø –û–î–û–ë–†–ï–ù–ù–´–• –ú–ï–°–¢ - –ü–£–ë–õ–ò–ß–ù–´–ô –î–û–°–¢–£–ü
    match /approvedPlaces/{placeId} {
      // üîì –ü–£–ë–õ–ò–ß–ù–û–ï –ß–¢–ï–ù–ò–ï - –í–°–ï –ú–û–ì–£–¢ –ß–ò–¢–ê–¢–¨ (–≤–∫–ª—é—á–∞—è –Ω–µ–∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã—Ö)
      allow read: if true;
      
      // üîí –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
      allow create, update: if request.auth != null && 
                           request.auth.token.email == 'malina@gmail.com';
      
      // üîí –£–¥–∞–ª–µ–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
      allow delete: if request.auth != null && 
                    request.auth.token.email == 'malina@gmail.com';
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—è
    function onlyUpdatingFields(allowedFields) {
      return resource.data.diff(request.resource.data).affectedKeys()
        .hasOnly(allowedFields);
    }
  }
}
```

### **3. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –Ω–∞–∂–º–∏—Ç–µ "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å"**

### **4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∑–∞–Ω–æ–≤–æ**
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –û—Ç–∫—Ä–æ–π—Ç–µ –∑–∞–Ω–æ–≤–æ  
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É

## üîç **–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**

### **–ë—ã–ª–æ (–Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–µ–µ –ø—Ä–∞–≤–∏–ª–æ):**
```javascript
allow create: if request.auth != null && 
             request.auth.uid == profileId &&  // ‚Üê –ù–ï –†–ê–ë–û–¢–ê–ï–¢!
             request.auth.uid == request.resource.data.userId;
```

### **–°—Ç–∞–ª–æ (—Ä–∞–±–æ—á–µ–µ –ø—Ä–∞–≤–∏–ª–æ):**
```javascript
allow create: if request.auth != null && 
             request.auth.uid == request.resource.data.userId;  // ‚Üê –†–ê–ë–û–¢–ê–ï–¢!
```

## ‚ö†Ô∏è **–ö—Ä–∏—Ç–∏—á–Ω–æ:**
–ü—Ä–∞–≤–∏–ª–∞ **–î–û–õ–ñ–ù–´** –±—ã—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤ Firebase Console, –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∞–≤–∏–ª –ù–ï –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

**–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª –∑–∞—è–≤–∫–∏ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è!** üöÄ 