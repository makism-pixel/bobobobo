rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // üë§ –ü–†–ê–í–ò–õ–ê –î–õ–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô
    match /users/{userId} {
      // –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –∏ –∏–∑–º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–π –¥–æ–∫—É–º–µ–Ω—Ç
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // ‚öôÔ∏è –ü–†–ê–í–ò–õ–ê –î–õ–Ø –ü–†–ï–î–ü–û–ß–¢–ï–ù–ò–ô –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô
    match /userPreferences/{userId} {
      // –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –∏ –∏–∑–º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // üì∏ –ü–†–ê–í–ò–õ–ê –î–õ–Ø –§–û–¢–û–ì–†–ê–§–ò–ô
    match /businessProfiles/{businessId}/photos/{photoId} {
      // –ß—Ç–µ–Ω–∏–µ: –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ñ–æ—Ç–æ
      allow read: if true;
      
      // –°–æ–∑–¥–∞–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –±–∏–∑–Ω–µ—Å–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
      allow create: if request.auth != null && 
        request.auth.uid == get(/databases/$(database)/documents/businessProfiles/$(businessId)).data.userId &&
        request.resource.data.size <= 5 * 1024 * 1024 && // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞
        request.resource.data.keys().hasAll(['id', 'originalUrl', 'thumbnailUrl', 'category', 'order', 'createdAt']); // –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
      allow update: if request.auth != null &&
        request.auth.uid == get(/databases/$(database)/documents/businessProfiles/$(businessId)).data.userId &&
        request.resource.data.diff(resource.data).affectedKeys()
          .hasOnly(['caption', 'order', 'isMain', 'updatedAt']); // –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
      
      // –£–¥–∞–ª–µ–Ω–∏–µ: –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Å–≤–æ–∏ —Ñ–æ—Ç–æ
      allow delete: if request.auth != null &&
        request.auth.uid == get(/databases/$(database)/documents/businessProfiles/$(businessId)).data.userId;
    }

    // üè¢ –ü–†–ê–í–ò–õ–ê –î–õ–Ø –ë–ò–ó–ù–ï–°-–ü–†–û–§–ò–õ–ï–ô
    match /businessProfiles/{profileId} {
      // –ß—Ç–µ–Ω–∏–µ: –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –¥–ª—è –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π
      allow read: if resource.data.isApproved == true || (
        request.auth != null && (
          request.auth.uid == resource.data.userId ||
          request.auth.token.email == 'malina@gmail.com'
        )
      );
      
      // –°–æ–∑–¥–∞–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
      allow create: if request.auth != null && 
                   request.auth.uid == request.resource.data.userId;
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
      allow update: if request.auth != null && (
        request.auth.uid == resource.data.userId ||
        request.auth.token.email == 'malina@gmail.com'
      );
      
      // –£–¥–∞–ª–µ–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
      allow delete: if request.auth != null && 
                   request.auth.token.email == 'malina@gmail.com';
    }
    
    // üìã –ü–†–ê–í–ò–õ–ê –î–õ–Ø –ú–ï–ù–Æ –ë–ò–ó–ù–ï–°–ê
    match /businessMenu/{itemId} {
      // –ß—Ç–µ–Ω–∏–µ: –≤—Å–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –º–µ–Ω—é (–≤–∫–ª—é—á–∞—è –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö)
      allow read: if true;
      
      // –°–æ–∑–¥–∞–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –±–∏–∑–Ω–µ—Å–∞ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –º–µ–Ω—é
      allow create: if request.auth != null && 
                   request.auth.uid == request.resource.data.userId;
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü —ç–ª–µ–º–µ–Ω—Ç–∞ –º–µ–Ω—é –∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
      allow update, delete: if request.auth != null && (
        request.auth.uid == resource.data.userId ||
        request.auth.token.email == 'malina@gmail.com'
      );
    }
    
    // üåç –ü–†–ê–í–ò–õ–ê –î–õ–Ø –û–î–û–ë–†–ï–ù–ù–´–• –ú–ï–°–¢ - –ü–£–ë–õ–ò–ß–ù–´–ô –î–û–°–¢–£–ü
    match /approvedPlaces/{placeId} {
      // –ß—Ç–µ–Ω–∏–µ: –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–≤–∫–ª—é—á–∞—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö)
      allow read: if true;
      
      // –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
      allow create, update: if request.auth != null && 
                           request.auth.token.email == 'malina@gmail.com';
      
      // –£–¥–∞–ª–µ–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
      allow delete: if request.auth != null && 
                   request.auth.token.email == 'malina@gmail.com';
    }

    // üìù –ü–†–ê–í–ò–õ–ê –î–õ–Ø –û–¢–ó–´–í–û–í
    match /reviews/{reviewId} {
      // –ß—Ç–µ–Ω–∏–µ: –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã–º –æ—Ç–∑—ã–≤–∞–º
      allow read: if true;
      
      // –ß—Ç–µ–Ω–∏–µ –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏: —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏–ª–∏ –≤–ª–∞–¥–µ–ª–µ—Ü –±–∏–∑–Ω–µ—Å–∞
      allow read: if request.auth != null && (
        request.auth.token.email == 'malina@gmail.com' ||
        request.auth.uid == resource.data.businessOwnerId
      );
      
      // –°–æ–∑–¥–∞–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
      allow create: if request.auth != null && 
                   request.auth.uid == request.resource.data.userId;
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (–¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏)
      allow update: if request.auth != null && 
                   request.auth.token.email == 'malina@gmail.com';
      
      // –£–¥–∞–ª–µ–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
      allow delete: if request.auth != null && 
                   request.auth.token.email == 'malina@gmail.com';
    }

    // üë• –ü–†–ê–í–ò–õ–ê –î–õ–Ø –ü–ï–†–°–û–ù–ê–õ–ê
    match /staff/{staffId} {
      // –ß—Ç–µ–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –±–∏–∑–Ω–µ—Å–∞ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
      allow read: if request.auth != null;
      
      // –°–æ–∑–¥–∞–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
      allow create: if request.auth != null;
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –≤–ª–∞–¥–µ–ª–µ—Ü –±–∏–∑–Ω–µ—Å–∞ –∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
      allow update: if request.auth != null;
      
      // –£–¥–∞–ª–µ–Ω–∏–µ: –≤–ª–∞–¥–µ–ª–µ—Ü –±–∏–∑–Ω–µ—Å–∞ –∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
      allow delete: if request.auth != null;
    }

    // üîî –ü–†–ê–í–ò–õ–ê –î–õ–Ø –£–í–ï–î–û–ú–õ–ï–ù–ò–ô –ê–î–ú–ò–ù–û–í
    match /adminNotifications/{notificationId} {
      // –ß—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å: —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
      allow read, write: if request.auth != null && 
                        request.auth.token.email == 'malina@gmail.com';
      
      // –°–æ–∑–¥–∞–Ω–∏–µ: –≤—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
      allow create: if request.auth != null;
    }
  }
} 